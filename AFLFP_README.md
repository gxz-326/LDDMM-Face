# ğŸ¯ AFLFP é¢ç˜«è¯†åˆ«å’Œåˆ†çº§æ¨¡å‹é›†æˆ

## ğŸ“Œ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆ **AFLFP (Face Landmark Face Palsy)** æ•°æ®é›†æ”¯æŒåˆ° LDDMM-Face æ¡†æ¶ä¸­ï¼Œç”¨äº**äººè„¸å…³é”®ç‚¹å®šä½**å’Œ**é¢ç˜«åˆ†çº§**ä»»åŠ¡ã€‚

### æ ¸å¿ƒç‰¹æ€§

âœ¨ **å®Œæ•´çš„æ•°æ®é›†é›†æˆ**
- AFLFP æ•°æ®é›†ç±»å®ç°
- CSV æ ¼å¼æ ‡æ³¨æ”¯æŒ
- è‡ªåŠ¨æ•°æ®å¢å¼ºå’Œé¢„å¤„ç†

âœ¨ **ä¼˜åŒ–çš„è®­ç»ƒé…ç½®**
- 68 ä¸ªæ ‡å‡†é¢éƒ¨å…³é”®ç‚¹
- HRNetV2 ä¸»å¹²ç½‘ç»œ
- é¢ç˜«åˆ†çº§æ ‡ç­¾æ”¯æŒ

âœ¨ **ä¸°å¯Œçš„å·¥å…·å’Œæ–‡æ¡£**
- CSV æ•°æ®å‡†å¤‡å·¥å…·
- å¯é€‰çš„åˆ†çº§åˆ†ç±»æ¨¡å—
- è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—

âœ¨ **çµæ´»çš„æ‰©å±•æ€§**
- æ¨¡å—åŒ–è®¾è®¡
- æ˜“äºå®šåˆ¶å‚æ•°
- æ”¯æŒè¿ç§»å­¦ä¹ 

## ğŸš€ 30 ç§’å¿«é€Ÿå¼€å§‹

```bash
# 1ï¸âƒ£ å‡†å¤‡æ•°æ®
mkdir -p data/aflfp/images
# æ”¾å…¥ä½ çš„å›¾åƒæ–‡ä»¶

# 2ï¸âƒ£ åˆ›å»ºæ ‡æ³¨æ–‡ä»¶ (CSV)
python tools/prepare_aflfp_data.py \
    --output data/aflfp/face_landmarks_aflfp_train.csv \
    --create-template

# 3ï¸âƒ£ ç¼–è¾‘CSVæ–‡ä»¶å¹¶å¡«å…¥æ•°æ®
# æ ¼å¼: image_path scale box_size center_x center_y x1 y1 ... x68 y68 palsy_grade

# 4ï¸âƒ£ å¼€å§‹è®­ç»ƒ
python tools/train.py --cfg experiments/aflfp/face_alignment_aflfp_hrnet_w18.yaml \
    DATASET.ROOT ./data/aflfp/images/ \
    DATASET.TRAINSET ./data/aflfp/face_landmarks_aflfp_train.csv \
    DATASET.TESTSET ./data/aflfp/face_landmarks_aflfp_test.csv
```

## ğŸ“ æ–°å¢æ–‡ä»¶åˆ—è¡¨

### æ ¸å¿ƒå®ç°
```
âœ¨ lib/datasets/aflfp.py                    # AFLFP æ•°æ®é›†ç±»
âœï¸  lib/datasets/__init__.py               # æ³¨å†Œ AFLFP (å·²ä¿®æ”¹)
âœï¸  lib/utils/transforms.py                # å…³é”®ç‚¹æ˜ å°„ (å·²ä¿®æ”¹)
âœ¨ experiments/aflfp/                      # AFLFP å®éªŒç›®å½•
âœ¨ experiments/aflfp/face_alignment_aflfp_hrnet_w18.yaml
```

### å·¥å…·å’Œæ¨¡å—
```
âœ¨ tools/prepare_aflfp_data.py             # æ•°æ®å‡†å¤‡å·¥å…·
âœ¨ lib/models/palsy_grading.py             # å¯é€‰åˆ†çº§æ¨¡å—
```

### æ–‡æ¡£
```
âœ¨ QUICK_START_AFLFP.md                    # â­ å¿«é€Ÿå¼€å§‹ (æ¨èé¦–å…ˆé˜…è¯»)
âœ¨ AFLFP_GUIDE.md                          # è¯¦ç»†ä½¿ç”¨æŒ‡å—
âœ¨ AFLFP_IMPLEMENTATION_SUMMARY.md         # å®ç°ç»†èŠ‚è¯´æ˜
âœ¨ AFLFP_IMPLEMENTATION_CHECKLIST.md       # å®Œæˆæ£€æŸ¥æ¸…å•
âœ¨ AFLFP_README.md                         # æœ¬æ–‡ä»¶
```

## ğŸ“Š CSV æ•°æ®æ ¼å¼

**æ–‡ä»¶æ ¼å¼**: ç©ºæ ¼åˆ†éš”çš„çº¯æ–‡æœ¬æ–‡ä»¶

**åˆ—æ•°**: 142 åˆ— (å›ºå®š)

**åˆ—å®šä¹‰**:
| # | åç§° | ç±»å‹ | èŒƒå›´/ç¤ºä¾‹ |
|---|------|------|----------|
| 1 | image_path | string | `img_001.jpg` |
| 2 | scale | float | `1.5` |
| 3 | box_size | float | `300.0` |
| 4-5 | center_x, center_y | float | `256.0 256.0` |
| 6-141 | 68ä¸ªå…³é”®ç‚¹åæ ‡ | float Ã— 136 | `x1 y1 x2 y2 ... x68 y68` |
| 142 | palsy_grade | int | `0-6` |

**ç¤ºä¾‹è¡Œ**:
```
img_001.jpg 1.5 300 256.0 256.0 100 50 105 52 110 55 ... 300 350 2
```

## ğŸ”§ ä¸»è¦é…ç½®å‚æ•°

ç¼–è¾‘ `experiments/aflfp/face_alignment_aflfp_hrnet_w18.yaml`:

```yaml
MODEL:
  NUM_JOINTS: 68              # âš ï¸ ä¸è¦æ”¹å˜
  IMAGE_SIZE: [256, 256]      # è¾“å…¥å›¾åƒå¤§å°
  HEATMAP_SIZE: [64, 64]      # è¾“å‡ºçƒ­åŠ›å›¾å¤§å°
  SIGMA: 1.5                  # é«˜æ–¯çƒ­åŠ›å›¾å®½åº¦

DATASET:
  ROOT: './data/aflfp/images/'
  TRAINSET: './data/aflfp/face_landmarks_aflfp_train.csv'
  TESTSET: './data/aflfp/face_landmarks_aflfp_test.csv'
  FLIP: true                  # æ°´å¹³ç¿»è½¬å¢å¼º
  SCALE_FACTOR: 0.25          # ç¼©æ”¾å¢å¼ºèŒƒå›´
  ROT_FACTOR: 30              # æ—‹è½¬å¢å¼ºèŒƒå›´

TRAIN:
  BATCH_SIZE_PER_GPU: 16      # è°ƒæ•´ä»¥é€‚åº”æ˜¾å­˜
  END_EPOCH: 100              # è®­ç»ƒè½®æ•°
  LR: 0.0002                  # å­¦ä¹ ç‡
  LR_STEP: [50, 80]           # å­¦ä¹ ç‡è¡°å‡è½®æ•°
```

## ğŸ¯ 68 ä¸ªå…³é”®ç‚¹å®šä¹‰

| éƒ¨åˆ† | ç´¢å¼• | æ•°é‡ | è¯´æ˜ |
|------|------|------|------|
| è½®å»“ | 1-17 | 17 | è„¸éƒ¨è½®å»“ |
| çœ‰æ¯› | 18-27 | 10 | å·¦å³çœ‰æ¯› (å„5ä¸ª) |
| é¼»å­ | 28-36 | 9 | é¼»å­ (ä¸Šä¸‹) |
| çœ¼ç› | 37-48 | 12 | å·¦å³çœ¼ç› (å„6ä¸ª) |
| å˜´å·´ | 49-68 | 20 | å˜´å·´è½®å»“ |

*æ³¨: ä½¿ç”¨æ ‡å‡† 300-W æ ¼å¼*

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸŒŸ æ¨èé˜…è¯»é¡ºåº

1. **æœ¬æ–‡ä»¶** (5åˆ†é’Ÿ) - å¿«é€Ÿäº†è§£
2. **QUICK_START_AFLFP.md** (10åˆ†é’Ÿ) - å¿«é€Ÿå¼€å§‹
3. **AFLFP_GUIDE.md** (20åˆ†é’Ÿ) - è¯¦ç»†æŒ‡å—
4. **AFLFP_IMPLEMENTATION_SUMMARY.md** (15åˆ†é’Ÿ) - æ·±å…¥ç†è§£

### ğŸ“– æŒ‰ä¸»é¢˜æŸ¥æ‰¾

- **æˆ‘æƒ³ç«‹å³å¼€å§‹**: â†’ **QUICK_START_AFLFP.md**
- **æˆ‘éœ€è¦äº†è§£å®Œæ•´æµç¨‹**: â†’ **AFLFP_GUIDE.md**
- **æˆ‘æƒ³äº†è§£æŠ€æœ¯ç»†èŠ‚**: â†’ **AFLFP_IMPLEMENTATION_SUMMARY.md**
- **æˆ‘éœ€è¦æ£€æŸ¥å®ç°å®Œæˆåº¦**: â†’ **AFLFP_IMPLEMENTATION_CHECKLIST.md**

## âš¡ å¸¸ç”¨å‘½ä»¤

```bash
# åˆ›å»º CSV æ¨¡æ¿
python tools/prepare_aflfp_data.py --output train.csv --create-template

# éªŒè¯ CSV æ ¼å¼
python tools/prepare_aflfp_data.py --csv train.csv --validate

# åŸºç¡€è®­ç»ƒ
python tools/train.py --cfg experiments/aflfp/face_alignment_aflfp_hrnet_w18.yaml

# è‡ªå®šä¹‰å‚æ•°è®­ç»ƒ
python tools/train.py --cfg experiments/aflfp/face_alignment_aflfp_hrnet_w18.yaml \
    TRAIN.BATCH_SIZE_PER_GPU 32 \
    TRAIN.END_EPOCH 150 \
    TRAIN.LR 0.0001

# ä»æ£€æŸ¥ç‚¹ç»§ç»­è®­ç»ƒ
python tools/train.py --cfg experiments/aflfp/face_alignment_aflfp_hrnet_w18.yaml \
    TRAIN.RESUME True \
    TRAIN.CHECKPOINT path/to/checkpoint.pth

# æµ‹è¯•æ¨¡å‹
python tools/test.py --cfg experiments/aflfp/face_alignment_aflfp_hrnet_w18.yaml \
    TEST.DATASET AFLFP \
    MODEL.PRETRAINED path/to/model.pth
```

## âš ï¸ å¸¸è§é—®é¢˜å¿«é€Ÿè§£ç­”

### Q: CSV ä¸­åº”è¯¥æœ‰å¤šå°‘åˆ—ï¼Ÿ
**A:** å›ºå®š **142 åˆ—** = 1 + 1 + 1 + 2 + 136 + 1

### Q: ä¸ºä»€ä¹ˆè®­ç»ƒå‡ºç° "shape mismatch" é”™è¯¯ï¼Ÿ
**A:** æ£€æŸ¥ CSV ä¸­çš„å…³é”®ç‚¹æ•°ã€‚å¿…é¡»æ˜¯ 68 ä¸ªå…³é”®ç‚¹ (136 ä¸ªåæ ‡å€¼)ã€‚

### Q: å¯ä»¥ä½¿ç”¨ä¸åŒæ•°é‡çš„å…³é”®ç‚¹å—ï¼Ÿ
**A:** å¯ä»¥ï¼Œä½†éœ€è¦ä¿®æ”¹é…ç½®ä¸­çš„ `MODEL.NUM_JOINTS`ã€‚

### Q: é¢ç˜«çš„ä¾§é¢æ€§åœ¨ç¿»è½¬å¢å¼ºä¸­ä¼šä¸¢å¤±å—ï¼Ÿ
**A:** æ˜¯çš„ã€‚ç¦ç”¨ç¿»è½¬å¢å¼º: `DATASET.FLIP: false`

### Q: å¦‚ä½•è¿›è¡Œåˆ†çº§åˆ†ç±»ï¼Ÿ
**A:** å¯é€‰åœ°ä½¿ç”¨ `lib/models/palsy_grading.py` æ¨¡å—ã€‚è¯¦è§æ–‡æ¡£ã€‚

### Q: GPU å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ
**A:** å‡å° `TRAIN.BATCH_SIZE_PER_GPU` (å¦‚ä» 16 æ”¹ä¸º 8)

### Q: èƒ½ä»å…¶ä»–æ•°æ®é›†è¿ç§»å­¦ä¹ å—ï¼Ÿ
**A:** å¯ä»¥ï¼å…ˆåœ¨ AFLW æˆ–å…¶ä»–æ•°æ®é›†ä¸Šé¢„è®­ç»ƒï¼Œå†åœ¨ AFLFP ä¸Šå¾®è°ƒã€‚

## ğŸ“ è¿›é˜¶ç”¨æ³•

### ç»“åˆå…¶ä»–æ•°æ®é›†

```bash
# 1. å…ˆåœ¨ AFLW ä¸Šè®­ç»ƒ
python tools/train.py --cfg experiments/aflw/face_alignment_aflw_hrnet_w18.yaml

# 2. åœ¨ AFLFP ä¸Šå¾®è°ƒ
python tools/train.py --cfg experiments/aflfp/face_alignment_aflfp_hrnet_w18.yaml \
    MODEL.PRETRAINED output/aflw_best.pth
```

### åŠ å…¥åˆ†çº§åˆ†ç±»

è¯¦è§ `lib/models/palsy_grading.py` å’Œ `AFLFP_IMPLEMENTATION_SUMMARY.md`ã€‚

## ğŸ“ˆ é¢„æœŸæ€§èƒ½

| æŒ‡æ ‡ | é¢„æœŸå€¼ |
|------|--------|
| å…³é”®ç‚¹ç²¾åº¦ (NME) | < 5% |
| æ¨ç†é€Ÿåº¦ | 30-50 FPS |
| æ˜¾å­˜å ç”¨ | 2-3 GB per GPU |
| è®­ç»ƒæ—¶é—´ | 8-24 å°æ—¶ |

## ğŸ”„ å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. å‡†å¤‡ AFLFP æ•°æ®  â”‚
â”‚  (å›¾åƒ + æ ‡æ³¨)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. åˆ›å»º CSV æ–‡ä»¶    â”‚
â”‚  (æ ‡å‡†æ ¼å¼)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. éªŒè¯æ•°æ®æ ¼å¼    â”‚
â”‚  (è¿è¡ŒéªŒè¯å·¥å…·)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ä¿®æ”¹é…ç½®æ–‡ä»¶    â”‚
â”‚  (è®¾ç½®æ•°æ®è·¯å¾„)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. å¼€å§‹è®­ç»ƒ        â”‚
â”‚  (è¿è¡Œ train.py)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. è¯„ä¼°ç»“æœ        â”‚
â”‚  (è¿è¡Œ test.py)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. éƒ¨ç½²æ¨¡å‹        â”‚
â”‚  (æ¨ç†åº”ç”¨)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

1. âœ… CSV æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Ÿè¿è¡Œ `prepare_aflfp_data.py --validate`
2. âœ… æ•°æ®è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Ÿæ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ `DATASET.ROOT` ç­‰
3. âœ… æ˜¾å­˜æ˜¯å¦è¶³å¤Ÿï¼Ÿå°è¯•å‡å° `BATCH_SIZE_PER_GPU`
4. âœ… ä¾èµ–åŒ…æ˜¯å¦å®Œæ•´ï¼Ÿæ£€æŸ¥ `requirements.txt`
5. ğŸ“– æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£è·å–æ›´å¤šä¿¡æ¯

## ğŸ“ ä¿®æ”¹å†å²

### v1.0 (2024å¹´)
- âœ… AFLFP æ•°æ®é›†é›†æˆ
- âœ… 68 ä¸ªå…³é”®ç‚¹æ”¯æŒ
- âœ… é¢ç˜«åˆ†çº§æ ‡ç­¾æ”¯æŒ
- âœ… å¯é€‰åˆ†çº§åˆ†ç±»æ¨¡å—
- âœ… å®Œæ•´æ–‡æ¡£å’Œå·¥å…·

## ğŸ“„ è®¸å¯è¯

éµå¾ªåŸ LDDMM-Face é¡¹ç›®çš„è®¸å¯è¯

## ğŸ‰ æ€»ç»“

ç°åœ¨æ‚¨æ‹¥æœ‰äº†ä¸€ä¸ª**å®Œæ•´çš„ã€ç”Ÿäº§å°±ç»ªçš„** AFLFP æ¨¡å‹é›†æˆï¼

### âœ¨ æ ¸å¿ƒèƒ½åŠ›
- âœ… äººè„¸å…³é”®ç‚¹å®šä½ (68 ç‚¹)
- âœ… é¢ç˜«åˆ†çº§æ ‡ç­¾ç®¡ç†
- âœ… çµæ´»çš„æ•°æ®å¤„ç†
- âœ… å¯é€‰çš„å¤šä»»åŠ¡å­¦ä¹ 

### ğŸš€ ä¸‹ä¸€æ­¥
1. å‡†å¤‡ä½ çš„ AFLFP æ•°æ®é›†
2. æŒ‰ç…§ `QUICK_START_AFLFP.md` å¿«é€Ÿå¼€å§‹
3. è°ƒæ•´å‚æ•°ä»¥è·å¾—æœ€ä½³æ€§èƒ½
4. éƒ¨ç½²åˆ°å®é™…åº”ç”¨

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸŠ

---

**è·å–å¸®åŠ©**: 
- å¿«é€Ÿé—®é¢˜: æŸ¥çœ‹ `QUICK_START_AFLFP.md` çš„å¸¸è§é—®é¢˜
- è¯¦ç»†æŒ‡å¯¼: é˜…è¯» `AFLFP_GUIDE.md`
- æŠ€æœ¯ç»†èŠ‚: å‚è€ƒ `AFLFP_IMPLEMENTATION_SUMMARY.md`
